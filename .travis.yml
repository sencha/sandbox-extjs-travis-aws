env:
  global:
    - secure: "IoNuqhxfcUcr+f7bboXk7jVoCSA804Hfaf4ses4T8d3XI3nLvdfZRPdpypvHdKqFkLCDlGfryZpSnlovnYmUdj5zyLLL/WO8z/j91g6act4DdYdFya66dSsyblDazWL2jAcHDUpF2yveY7OP3js4vFWgT7thAM2yPqTjdLfB054Q35bV/cfiVsqclaGXG21GvNRaVxBts2n05BC9D4MuIgDh5OKXC4SIuzjzYvQzmZ7/F+TDWUKETcnPthmjgfRXdiwJuyzKYY642ETbtNwSnEA8KbxKE1ux1TBOTLkOjhXA7XnwArn/rh7F9lnso7FbO6B8WNrR9ycIkj3xeUUjfOZd7VzWUmmGFZnMegZbP71/UcD+OiZrCniO4Hf4Yy64eutj40/tozIfww4rfwylZV8AcmREN30onB6WPaz6IYObodSyIHPFiunKtbQlRUumjD32FKXE+XikaeaciAe5l/9Gdm8+iQHzgid5DjVm2dllUqvSCmFVKqaF9QbgjcVlctyEH8/AAbTxPNn8wSlsc+I9TBmNGTJeVKuiD0YDwR6aR0DwgP3lc4aHPAbCJUhmEO01lSG8G2E6XtZFhqxRiApJHtWesLC5SnDM6hM6NXpr2yEPCo9+69VB/VKUe8VRNmb8kFRND8VFz5Tx4XRi+7lO/oYVFxsHZoYcvmbZD4U="
    - secure: "H9Ra92VtX9mzIeqwKAMpQKDfv0yEUf22zAppNIhgLn8QVu/XXqxPQ6YfqEskWLqAEbRdANzZrxpvtouCycrlS7LTg32weOpWOohC15SuoX53NN3kNjUpij+LTzC08JGm5q1iCjSSOHdrEHSLAxyudnjzco/+mnocswzKLpXPflbBt4lIjizmFmP+NBpdVZAzSXixN7f2WVthNqBvPBMLEOoGIOY+p9esMwH4Gkas23VGA2IrLGujAbaeOGHeCWcPp1j/W7gXJHIMsZnaei3eWIeNDAhDH8di1+5muy7et2+KxyvcWb394v70Yxp/B6BGZN+neymTxTKDyfkQtinmaUIfrj5lUm1Krs2LnllXIlySNAT5lRjfG7f8HiaLn5ZYQHHoCaRsUuXIuIVKyR6kYPNisDuYZMuv1vGZbsVWXLbdWkDFVCbJJaQ1veVqlYnIniv016U2p6gQcWuw+Ywe3btsh1dflQPMxrR/IrGz+ENHgn0tBpuJEn1N3h71RlwjVWnR2LMOEie41Vu8hDJcr94insAwv8cFuV2+uY18q4gw2Bd5+COYRzV8rHS+ku6akOpUIbH+hINnHzFfT5xsqeehWgABnRRCDEODjGHxUyxZtpHjCq/tGQthnDHVYkOYPdKPzPSJPq75L6VdQ0CGTnmzKyN6hFkQAmU6nXASuMM="

language: node_js
node_js:
 - "lts/*"

cache:
  npm: false

before_install:
  # NPM Login - commercial
  # - npm config set @sencha:registry https://npm.sencha.com/
  # - npm config set //npm.sencha.com/:_authToken=$SENCHA_NPM_TOKEN_VERDACCIO
  # NPM Login - early-adopter
  - npm config set @sencha:registry https://sencha.myget.org/F/early-adopter/npm/
  - npm config set //sencha.myget.org/F/early-adopter/npm/:_authToken=$SENCHA_NPM_TOKEN_EARLYADOPTER
  # For early adopter clean the cache 
  # Remove all package-lock.json files for early adopter. 
  #- npm cache clean --force
  #- npm cache verify

install: 
  - npm install
  - ls
  - pwd
  - cd ./client
  - pwd
  - npm install

script:
  - pwd
  - npm run build
  # Next steps are handeled in the Dockerfile
  # DockerFile is doing the copying to html directory
  #- cp -R ./client/build/production/ModernApp/* ./server/html

deploy:
  provider: elasticbeanstalk
  access_key_id:
    secure: "$AWS_ACCESS_KEY_ID"
  secret_access_key:
    secure: "$AWS_SECRET_ACCESS_KEY"
  region: "us-east-1"
  app: "sandbox-extjs-travis-aws"
  env: "sandbox-staging"
  bucket_name: "sencha-deploy-from-travis-tmp"


# Notes:
# https://travis-ci.com/github/sencha/sandbox-extjs-travis-aws/settings - contains private export variables

# Run Travis CLI in this repo
# gem install travis

# Delete Travis Cache
# travis cache --com
# travis cache --com --delete

# Encrypt Variables
# gem install travis
# travis login --pro --github-token replace_with_github_personal_token
# cd to/this/repo
# travis encrypt AWS_ACCESS_KEY_ID=xxx
# travis encrypt AWS_SECRET_ACCESS_KEY=xxx